var current_url="";function to_absolute(a){if(a.match(/http\:\/\//)){return a}else{if(a.substr(0,1)=="/"){return base+a.substr(1)}else{if(a.indexOf("?")!=-1){if(current_url.lastIndexOf("?")!=-1){return current_url.substring(0,current_url.lastIndexOf("?"))+a}return current_url+a}else{return current_url+a}}}}function async_load_callback(a,c,b){jQuery("body").html(a.body);jQuery("#loading-bg").css({opacity:0.75}).show();jQuery("title").html(a.title);jQuery(".content").html(a.content);capture_outbound();jQuery("#loading-bg").fadeTo("fast",0,function(){jQuery("#loading-bg").hide();jQuery("html, body").animate({scrollTop:0},100)})}function async_load(b,d,a){d.format="fragment";var c={url:to_absolute(b),data:d,type:a,dataType:"json"};c.success=function(f,h,g){var e=to_absolute(b);current_url=e;console.log("Current URL now "+current_url);window.location.hash=current_url;return async_load_callback(f,h,g)};c.error=function(f,g,e){jQuery("#loading-bg").html('<p style="position:fixed; top: 10%; width:100%; margin:0 auto; text-align:center;">Error loading page - please try again.</p>').css({"font-size":"20px","font-weight":"bold"}).fadeTo("fast",0.9,function(){setTimeout(function(){jQuery("#loading-bg").fadeTo("fast",0,function(){jQuery("#loading-bg").hide()})},1200)})};jQuery.ajax(c);jQuery("#loading-bg").show().fadeTo("fast",0.75);return false}function capture_outbound(){jQuery("form").submit(function(a){var b=jQuery(this).serializeArray();var d={};var c=0;for(c=0;c<b.length;c++){d[b[c].name]=b[c].value}return async_load(jQuery(this).attr("action"),d,jQuery(this).attr("method"))});console.log("Captured outbound forms");jQuery("a[href]").click(function(a){return async_load(jQuery(this).attr("href"),{},"GET")});console.log("Captured outbound links")}jQuery(document).ready(function(){if(window.location.hash!=current_url){console.log("Hash mismatch! "+window.location.hash+" != "+current_url+"! Reloading...");async_load(window.location.hash.substr(1),{},"GET")}capture_outbound()});