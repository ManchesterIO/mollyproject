var current_url="";function to_absolute(a){if(a.match(/http\:\/\//)){return a}else{if(a.substr(0,1)=="/"){return base+a.substr(1)}else{if(a.indexOf("?")!=-1){if(current_url.lastIndexOf("?")!=-1){return current_url.substring(0,current_url.lastIndexOf("?"))+a}return current_url+a}else{return current_url+a}}}}function load_callback(a,c,b){jQuery("body").html(a.body);jQuery("title").html(a.title);jQuery(".content").html(a.content);jQuery("#loading").hide();capture_outbound();jQuery("body").fadeTo("fast",1)}function ajax_load(b,d,a){d.format="fragment";console.log("Async loading "+b);console.log("    aka "+to_absolute(b));console.log("    with "+d);console.log("    meth "+a);var c={url:to_absolute(b),data:d,type:a,dataType:"json"};c.success=function(f,h,g){var e=to_absolute(b);current_url=e;console.log("Current URL now "+current_url);window.location.hash=current_url;return load_callback(f,h,g)};jQuery.ajax(c);jQuery("body").fadeTo("fast",0.1);jQuery("#loading").css({position:"fixed",top:"30%",left:"50%",opacity:"0.8"}).show();jQuery("#loading").fadeIn("fast");return false}function capture_outbound(){jQuery("form").submit(function(a){var b=jQuery(this).serializeArray();var d={};var c=0;for(c=0;c<b.length;c++){d[b[c].name]=b[c].value}return ajax_load(jQuery(this).attr("action"),d,jQuery(this).attr("method"))});jQuery("a[href]").click(function(a){return ajax_load(jQuery(this).attr("href"),{},"GET")})}jQuery(document).ready(function(){alert("WHEEEEEEEEEEEEE!");if(window.location.hash!=current_url){console.log("Hash mismatch! "+window.location.hash+" != "+current_url+"! Reloading...");ajax_load(window.location.hash.substr(1),{},"GET")}capture_outbound()});