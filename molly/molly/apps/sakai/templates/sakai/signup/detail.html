{% extends "sakai/base.html" %}{% load sakai %}{% load portal_misc %}

{% block extrahead %}

{% endblock %}

{% block content %}

<div class="section">
    <div class="header">
    <h2>{{ event.title }}</h2>
    </div>
{# Metadata about the tutorial slots #} 
<div class="bubble"><div class="article pad-10">   
<dl>
  <dt>Description</dt>
  {# CLENSE ME! #}
  <dd>{{ event.description }}</dd>
  <dt>Organiser</dt>
  <dd>{{ event.organizerName }}</dd>
  <dt>Location</dt>
  <dd>{{ event.location }}</dd>
  <dt>Date/Time</dt>
  <dd>{% ifequal event.start|date:"dMY" event.end|date:"dMY" %}
      {# Display Term Week + Name, Date + Time start -> end #}
        {{ event.startTime|from_sakai_timestamp|oxdate:"%(week)s%(ordinal)s Week %(term_long)s Term" }}, {{ event.startTime|from_sakai_timestamp|date:"d M Y" }} 
        {{ event.startTime|from_sakai_timestamp|date:"g:iA"|lower }} - {{ event.endTime|from_sakai_timestamp|date:"g:iA"|lower }}
      {% else %}
      {# Display startTime + startDate - endTime + endDate #}
        {{ event.startTime|from_sakai_timestamp|date:"g:iA, d M Y"|lower }} - {{ event.endTime|from_sakai_timestamp|date:"g:iA, d M Y"|lower }}
      {% endifequal %}
  </dd>

      
  <dt>Status</dt>
{% if event.startToSignUp and not event.passedDeadline %}
  <dd>Open to sign up until {{ event.signupDeadline|from_sakai_timestamp|date:"d M Y, g:iA"|lower }}</dd>
{% else %}
  {% if event.passedDeadline and not event.meetingExpired %}
  <dd>Sign up deadline has passed</dd>
  {% else %}
    {% if event.meetingExpired %}
  <dd>This meeting has already happened!</dd>
    {% else %}
  <dd>Sign up will open at {{ event.signupBegins|from_sakai_timestamp|date:"d M Y, g:iA"|lower }}</dd>
    {% endif %}
  {% endif %}
{% endif %}
</dl>
</div></div>
{# End Metadata about the tutorial slots #}


<table>
    <thead>
    <tr>
        <th></th>
        <th></th>
        <th></th>
   </tr>
   </thead>
   
   <tbody>
   
   {% for ts in event.signupTimeSlotItems %}
    <tr class="{% if ts.signedUp %}signed-up{%endif%}">
        <td></td>
        <td></td>
        <td></td>
    </tr>
   {% endfor %}
   </tbody>
</table>

{#
<ul>
{% for ts in event.signupTimeSlotItems %}
<li {% if ts.signedUp %} style="background:green;"{% endif %}>
    {# Time Range -- needs multi date possibility #}
    {{ ts.startTime|from_sakai_timestamp|date:"g:iA"|lower }} - {{ ts.endTime|from_sakai_timestamp|date:"g:iA"|lower }}
    <br />
    {# max Attendees #}
    <small>Places available: {{ ts|places_left }}/{{ ts.maxNoOfAttendees }}</small>
    <br />
{# if the tutorial is set up to display attendee names #}
{% if ts.displayAttendees %}
  {% for attendee in ts.attendees %}
          {{ attendee.displayName }}{% if not forloop.last %},{% endif %}
  {% endfor %}
{% else %}
{# otherwise #}
  {% if ts.signedUp and not ts.attendees|length_is:"1" %}
        You and {{ ts.attendees|length|add:"-1" }} other{{ ts.attendees|length|add:"-1"|pluralize }}
  {% else %}
    {% if ts.attendees|length_is:"0" %}
        No one yet
    {% else %}
        {{ ts.attendees|length }} attendee{{ ts.attendees|length|pluralize }}
    {% endif %}
  {% endif %}
{% endif %}
{# end #}

{# Is user signed up or on waiting list? #}
<br />{% if ts.signedUp %}
    You're Signed up
    {% else %}{% if ts.onWaitList %}You're on the waiting list
    {% endif %}
{% endif %}

<form method="post" action=".">
          <input type="hidden" name="timeslot_id" value="{{ ts.id }}"/>
{% comment %}
    If meeting has
       a) Not Expired
       b) Not passed its deadline
       c) Is available to sign up
       d) Time slot is not locked 
{% endcomment %}


{# The following mass of ifs results in a relevant button being displayed per time slot #}
{% if not event.meetingExpired and not event.passedDeadline and event.startToSignUp and not ts.locked %}
    {# User is signed up to this slot, display cancel button #}
  {% if ts.signedUp %}
          <button type="submit" name="action" value="cancelSignup">Cancel</button>
  {% else %}
    {# User is on waiting list #}
    {% if ts.onWaitList %}
          <button type="submit" name="action" value="removeWaitList">Leave waiting list</button>
    {% else %}
    {# Slot is available #}
      {% if ts.available %}
      {# User is signed up to a different slot #}
        {% if signedUp %}
          <button type="submit" name="action" value="addToWaitList">Move here</button>
        {% else %}
      {# Let user sign up #}
          <button type="submit" name="action" value="signup">Sign up</button>
        {% endif %}
      {% else %}      
      {# Let user join waiting list #}
          <button type="submit" name="action" value="addToWaitList">Join waiting list</button>
      {% endif %}
    {% endif %}
  {% endif %}
{% endif %}
</form>

</li>
{% endfor %}
</ul>

#}
</div>
{% endblock %}