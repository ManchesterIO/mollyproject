{% extends "maps/base.xhtml" %}
{% load maps %}{% load portal_misc %}

{% block breadcrumbs %}
{{ block.super }}
	<li><a href="{% url maps_index %}">
        <img src="{{ MEDIA_URL }}png/maps-bc.png" alt="Maps"/>
    </a></li>
    <li><a href="{% url maps_nearby_detail entity.entity_type.slug %}">&hellip;</a></li>
{% endblock %}

{% block pagetitle %}{{ data.dc_title }}{% endblock %}

{% block title %}OMP | {{ data.dc_title }}{% endblock %}

{% block content %}


<div class="list-section">
<h2 class="section-header">{{ data.dc_title }}</h2>


<dl class="ml">

{% if data.oxp_hasHomepage or data.oxp_hasITHomepage or data.oxp_hasWeblearn or data.oxp_hasLibraryHomepage %}
<dt>Websites</dt>

{% if data.oxp_hasHomepage %}
    <dd><a href="{{ data.oxp_hasHomepage.uri }}">Homepage</a></dd>
{% endif %}
{% if data.oxp_hasITHomepage %}
    <dd><a href="{{ data.oxp_hasITHomepage.uri }}">IT Homepage</a></dd>
{% endif %}
{% if data.oxp_hasWeblearn %}
    <dd><a href="{{ data.oxp_hasWeblearn.uri }}">Weblearn</a></dd>
{% endif %}
{% if data.oxp_hasLibraryHomepage %}
    <dd><a href="{{ data.oxp_hasLibraryHomepage.uri }}">Library</a></dd>
{% endif %}
{% endif %}

{% if data.oxp_occupies %}
<dt>Occupies</dt>

{% for place in data.oxp_occupies %}
{% with place|load_oxp_json as place_json %}
    <dd><a href="{{ place_json|oxp_portal_url }}">{{ place_json.dc_title }}</a></dd>
{% endwith %}
{% endfor %}

{% endif %}

{% if data.passiveProperties.oxp_occupies %}
<dt>Occupied by</dt>

{% for place in data.passiveProperties.oxp_occupies %}
{% with place|load_oxp_json as place_json %}
    <dd><a href="{{ place_json|oxp_portal_url }}">{{ place_json.dc_title }}</a></dd>
{% endwith %}
{% endfor %}

{% endif %}

{% if data.oxp_subsetOf %}
<dt>Parent unit</dt>
{% with data.oxp_subsetOf|load_oxp_json as place_json %}
<dd><a href="{{ place_json|oxp_portal_url }}">{{ place_json.dc_title }}</a></dd>
{% endwith %}
{% endif %}

{% if data.passiveProperties.oxp_subsetOf %}
<dt>Sub-units</dt>

{% for place in data.passiveProperties.oxp_subsetOf %}
{% with place|load_oxp_json as place_json %}
    <dd><a href="{{ place_json|oxp_portal_url }}">{{ place_json.dc_title }}</a></dd>
{% endwith %}
{% endfor %}

{% endif %}

{% if data.oxp_physicallyContainedWithin %}
<dt>Contained within</dt>

{% with data.oxp_physicallyContainedWithin|load_oxp_json as place_json %}
    <dd><a href="{{ place_json|oxp_portal_url }}">{{ place_json.dc_title }}</a></dd>
{% endwith %}

{% endif %}

{% if data.passiveProperties.oxp_physicallyContainedWithin %}
<dt>Contains</dt>

{% for place in data.passiveProperties.oxp_physicallyContainedWithin %}
{% with place|load_oxp_json as place_json %}
    <dd><a href="{{ place_json|oxp_portal_url }}">{{ place_json.dc_title }}</a></dd>
{% endwith %}
{% endfor %}

{% endif %}

</dl>
</div>

{% if data.oxp_inImage %}
<div class="section-nopad">
<h2 class="section-header">Images</h2>
{% for image in data.oxp_inImage %}
{% external_image image.uri asdiv %}
{% endfor %}
</div>
{% endif %}


<div class="list-section">
    <h2 class="section-header">Map</h2>

{% if entity.location %}
    
<div class="backgrounded-image" style="background-image:url('{% map_url entity.location %}'); height:{{ device.max_image_height }}px">
{% include "maps/map_elements.xhtml" %}
</div><div class="list-footer">
    <a href="{% url maps_entity_nearby_list entity.entity_type.slug,entity.display_id %}">Find things near here</a>
</div>
{% else %}
    <p>We do not yet have a location for this {{ entity.entity_type.verbose_name }}.</p>
{% endif %}
</div>

<p>Is favourite: {{ entity.is_favourite }}</p>

<form method="post" action="{% url maps_entity_favourite entity.entity_type.slug entity.display_id %}">
<input type="hidden" name="is_favourite" value="{{ entity.is_favourite|yesno:"false,true" }}"/>
<input type="submit" value="{{ entity.is_favourite|yesno:"unset,set" }}"/>
</form>


{% endblock %}
