{% extends "contact/base.xhtml" %}{% load portal_misc %}

{% block stylesheets %}
{{ block.super }}
<link rel="stylesheet" type="text/css" href="{{ MEDIA_URL }}css/contact.css"/>
{% endblock %}

{% block title %}m.ox | Contact search{% if query %}: {{ query }}{% endif %}{% endblock %}

{% block extrahead %}{{ block.super }}
{% if query %}
<script type="text/javascript">
    var query = "{{ query }}";
    var query_enc = "{{ query|urlencode }}";
    var page = {{ page }};
    var page_count = {{ page_count }};
    var method = "{{ method }}";
</script>
{% endif %}
<script type="text/javascript" src="{{ MEDIA_URL }}js/contact.js"> </script>
{% endblock %}

{% block pagetitleclass %}contact-header with-icon{% endblock %}
{% block pagetitle %}Contact search{% endblock %}

{% block content %}

<div class="section-nopad">
  <form method="get" action=".">
    <h2 class="section-header">
      <label for="query">Search</label>
    </h2>

    <div class="section-content">
      <p style="text-align:center">
        <input id="query" name="q" value="{{ query }}" style="width:90%; height:20px; font-size:16pt"/>
      </p><p style="text-align:center">
        <button type="submit" name="method" value="email">E-mail</button>
        <button type="submit" name="method" value="phone">Phone</button>
      </p>
    </div>
  </form>
</div>

{% if query %}

<div class="list-section">
  <h2 class="section-header">Results</h2>


  {% if message %}
  <div class="list-note"><div class="bubble">
    {{ message }}
  </div></div>
  {% endif %}

  {% if people %}
  <div class="list-note"><div class="bubble">
    {% if page_count|gte:4 %}
    Your search returned {{results_count}} item{{ results_count|pluralize }}. Try adding an initial to get more specific results.
	{% else %}
    Your search returned {{results_count}} item{{ results_count|pluralize }}.
    {% endif %}
  </div></div>

    {% ifnotequal 1 page_count %}
  <div class="list-note">
      Pages:
          {% for page in pages %}
      <a href="?page={{ page }}&amp;method={{ method }}&amp;q={{ query|urlencode }}" style="display:inline;">{{ page }}</a>
          {% endfor %}
  </div>
    {% endifnotequal %}

  <ul class="ml" id="people">
    {% for person in people %}
    <li{% if forloop.last %} class="notbottom"{% endif %}>
      {% ifequal method "email" %}
      <a class="email" href="mailto:{{ person.email }}">
      {% else %}
      <a class="phone" href="{{ person.phone.1|telephone_uri }}">
      {% endifequal %}
        <span class="name">{{ person.name }}</span>
        <br/>
        <small><span class="unit">{% if person.unit %}{{ person.unit }}{% else %}<em>Unknown affiliation</em>{% endif %}</span><br />
		{% ifequal method "email" %}
		    {{ person.email }}
        {% else %}
		    {{ person.phone.1 }}
		{% endifequal %}
		</small>
      </a>
    </li>
    {% endfor %}
  </ul>

    {% ifnotequal 1 page_count %}
  <div class="list-footer" id="more_contact_results">
      Pages:
          {% for page in pages %}
      <a href="?page={{ page }}&amp;method={{ method }}&amp;q={{ query|urlencode }}" style="display:inline;">{{ page }}</a>
          {% endfor %}
  </div>
    {% endifnotequal %}

  {% else %}{% if not message %}
  <div class="list-footer"><div class="bubble">
    Your search didn't return any results.
  </div></div>
  {% endif %}
  {% endif %}
</div>
{% endif %}

{% if not query %}

<div class="list-section">
<h2 class="section-header">University contacts</h2>
<ul class="ml">
    <li><a class="phone" href="tel:+441865270000">General enquiries</a></li>
    <li><a class="phone" href="tel:+441865280000">Switchboard</a></li>
    <li><a class="phone" href="tel:+441865273200">Computing Services help desk</a></li>
</ul>
</div>

<div class="list-section">
<h2 class="section-header">Emergency contacts</h2>
<ul class="ml">
    <li><a class="phone" href="tel:112">Emergency services</a><br /><small>112</small></li>
    <li><a class="phone" href="tel:+441865289999">University security <small>(emergency)<br /> +44 1865 289999</small></a></li>
    <li><a class="phone" href="tel:+441865272944">University security <small>(enquiries)<br /> +44 1865 272944</small></a></li>
    <li><a class="phone" href="tel:+448458505505">Thames Valley Police <small>(non-emergency)<br /> +44 8458 505505</small></a></li>
</ul>
</div>

<div class="list-section">
<h2 class="section-header">Health and welfare</h2>
<ul class="ml">
    <li><a class="phone" href="tel:+448454647">NHS Direct</a></li>
    <li><a class="phone" href="tel:+441865270300">Counselling Service</a></li>
    <li><a class="phone" href="tel:+441865270270">Oxford Nightline</a></li>
    <li><a class="phone" href="tel:+441865726295">Rape Crisis</a></li>
    <li><a class="phone" href="tel:+448457909090">Samaritans</a></li>
</ul>
</div>
  
{% comment %}  

{# Update to retrieve College/Department contacts #}
<div class="list-section">
<h2 class="section-header">Other contacts</h2>
<ul class="ml">
    <li class="email"><a href="{% url contact_quick %}">College contacts</a></li>
    <li><a href="{% url contact_quick %}">Department contacts</a></li>
</ul>
</div>
{% endcomment %}


{% endif %}

{% endblock %}
