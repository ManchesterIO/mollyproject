{% load maps %}

<div class="note"><div class="bubble pad-10">
{% if preferences.location.name %}

<p class="location-container">
  <span class="location-status">
    Current location: <span class="location">{{ preferences.location.name }}
  </span>.
</p>

{% else %}
<p class="location-container">
  <span class="location-status">We do not yet know where you are.</span>
</p>
{% endif %}

<div class="update-location">

{% if not form.cleaned_data.name %}
<div id="geolocate-js"> </div>
{% endif %}

{% if form.cleaned_data.name %}

<h2>Did you mean:</h2>

{% if map_url %}

{% ifnotequal style_group "dumb" %}
    <div class="backgrounded-image" style="background-image:url('{{ map_url }}'); height:{{ map_height }}px">
    {% include "maps/map_elements.xhtml" %}
    </div>
{% else %}
    <img src="{{ map_url }}}" alt="Map"><br />
    {% include "maps/map_elements.xhtml" %}
{% endifnotequal %}


{% endif %}

<ul>
{% for placemark in placemarks %}
    <li>
        <form method="post" action="{% url core_update_location %}" class="submit-location-form">
            <input type="hidden" name="name" value="{{ placemark.0 }}"/>
            <input type="hidden" name="latitude" value="{{ placemark.1.0 }}"/>
            <input type="hidden" name="longitude" value="{{ placemark.1.1 }}"/>
            <input type="hidden" name="accuracy" value="{{ placemark.2 }}"/>
            <input type="hidden" name="method" value="geocoded"/>
            <input type="hidden" name="return_url" value="{{ return_url|default:"" }}"/>
            <button class="as_link" type="submit" name="index" style="width:100%">{{ forloop.counter }}. {{ placemark.0 }}</button>
        </form>
    </li>
{% endfor %}
</ul>

{% else %}

<form method="get" action="{% url core_update_location %}" id="manual_location_form">
        <label for="location">Set a new location</label>:
        <input name="return_url" type="hidden" value="{{ return_url|default:path }}"/>
        <input id="location" name="name" value="{{ location }}"/>
        <input type="submit" value="Update"/><br/>
        <small>Examples: 'oucs' (a unit code), 'Trinity College' (a college or department), 'Parks Road' (an address), 'OX1 3PG' (a postcode).</small>

</form>

{% endif %}


</div></div></div>

{% comment %}
<h2>Automatic geolocation</h2>
<div class="note"><div class="bubble pad-5">
{% if preferences.location.placemark %}
        <p id="location_status">We think you are somewhere near <strong class="nobr">{{ preferences.location.placemark.0 }}</strong> ({{ preferences.location.location.0 }} {{ preferences.location.location.1 }}).</p>
{% else %}
{% if preferences.location.location %}
        <p id="location_status">We think you are somewhere near <strong class="nobr">{{ preferences.location.location.0 }} {{ preferences.location.location.1 }}</strong>.</p>
{% else %}
        <p id="location_status">Sorry, but we are unable to determine your location automatically.</p>
        <script type="text/javascript">
            $(document).ready(function() {
                if (require_location && positionMethodAvailable())
                    $('#location_status').html('We do not yet have a location for you; please wait while we attempt to determine one.');
                else if (positionMethodAvailable())
                    $('#location_status').css('display', 'none');
            });
        </script>
{% endif %}
{% endif %}
<p id="location_update"> </p>
        <script type="text/javascript">
            if (positionMethodAvailable())
                $('#location_update').append(' <a href="#" onclick="javascript:requestPosition();">Determine automatically<\/a>');
        </script>
        </div></div>
</div>
{% endcomment %}
