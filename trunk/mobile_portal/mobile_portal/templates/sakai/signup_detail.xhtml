{% extends "sakai/base.xhtml" %}{% load sakai %}

{% block pagetitle %}Meetings{% endblock %}

{% block content %}

{{ event }}

<dl>
  <dt>Title</dt>
  <dd>{{ event.title }}</dd>
  <dt>Organiser</dt>
  <dd>{{ event.organizerName }}</dd>
  <dt>Location</dt>
  <dd>{{ event.location }}</dd>
  <dt>Time</dt>
  <dd>{{ event.startTime|from_sakai_timestamp|date:"d M Y, H:i" }} - {{ event.endTime|from_sakai_timestamp|date:"H:i" }}</dd>
  <dt>Status</dt>
{% if event.startToSignUp %}
  <dd>Open to sign up (closes {{ event.signupDeadline|from_sakai_timestamp|date:"d M Y, H:i" }})</dd>
{% else %}
  {% if event.passedDeadline %}
  <dd>Sign up deadline has passed</dd>
  {% else %}
    {% if event.meetingExpired %}
  <dd>This meeting has expired</dd>
    {% else %}
  <dd>Sign up will open at {{ event.signupBegins|from_sakai_timestamp|date:"d M Y, H:i" }}</dd>
    {% endif %}
  {% endif %}
{% endif %}
</dl>

<table>
  <thead>
    <tr>
      <th>Timeslot</th>
      <th>Max participants</th>
      <th>Participants</th>
      <th>Status</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody>
{% for ts in event.signupTimeSlotItems %}
    <tr>
      <td>
        {{ ts.startTime|from_sakai_timestamp|date:"H:i" }} - {{ ts.endTime|from_sakai_timestamp|date:"H:i" }}
      </td>
      <td>{{ ts.maxNoOfAttendees }}</td>
      <td>
{% if ts.displayAttendees %}
        <ul>
  {% for attendee in ts.attendees %}
          <li>{{ attendee.displayName }}</li>
  {% endfor %}
        </ul>
{% else %}
  {% if ts.signedUp %}
    {% if ts.attendees|length_is:"1" %}
        You
    {% else %}
        You and {{ ts.attendees|length }} other{{ ts.attendees|length|pluralize }}
    {% endif %}
  {% else %}
    {% if ts.attendees|length_is:"0" %}
        No one yet
    {% else %}
        {{ ts.attendees|length }} attendee{{ ts.attendees|length|pluralize }}
    {% endif %}
  {% endif %}
{% endif %}
      </td>
      <td>{% if ts.signedUp %}Signed up{% else %}{% if ts.onWaitList %}On waiting list{% endif %}{% endif %}</td>
      <td>
        <form method="post" action=".">
          <input type="hidden" name="timeslot_id" value="{{ ts.id }}"/>
{% if not event.meetingExpired and not event.passedDeadline and event.startToSignUp and not ts.locked %}
  {% if ts.signedUp %}
          <button type="submit" name="action" value="cancelSignup">Cancel</button>
  {% else %}
    {% if ts.onWaitList %}
          <button type="submit" name="action" value="removeWaitList">Leave waiting list</button>
    {% else %}
      {% if ts.available %}
        {% if signedUp %}
          <button type="submit" name="action" value="addToWaitList">Move here</button>
        {% else %}
          <button type="submit" name="action" value="signup">Sign up</button>
        {% endif %}
      {% else %}      
          <button type="submit" name="action" value="addToWaitList">Join waiting list</button>
      {% endif %}
    {% endif %}
  {% endif %}
{% endif %}
        </form>
      </td>
    </tr>
{% endfor %}
  </tbody>
</table>

{% endblock %}